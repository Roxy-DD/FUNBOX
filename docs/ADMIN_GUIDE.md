# 管理后台使用指南

Mizuki 博客现已集成功能完善的管理后台，支持可视化管理项目、技能和时间线数据。

## ⚠️ 重要安全说明

> **本管理后台仅用于本地开发环境，绝不应部署到生产环境！**

### 关键要点：

1. **本地开发工具**
   - 管理后台运行在本地（localhost:3000 和 localhost:3001）
   - 仅用于开发阶段编辑数据
   - 不是生产功能

2. **保持静态特性**
   - Mizuki 博客仍然是 100% 静态网站
   - JSON 数据在**构建时**转换为 TypeScript
   - 生产部署只包含静态文件，无 API，无服务器
   - `admin/` 文件夹不包含在生产构建中

3. **安全最佳实践**
   - ❌ 永远不要在生产环境运行 `pnpm admin`
   - ❌ 不要将 admin 服务器暴露到互联网
   - ❌ `admin/` 文件夹不应部署到 Cloudflare/Vercel 等平台
   - ✅ 只在本地开发时使用
   - ✅ 编辑完成后执行 `pnpm build` 生成静态文件
   - ✅ 只部署 `dist/` 目录（纯静态文件）

### 工作流程：

```
本地开发:  编辑数据(Admin) → 同步到 TS → Git commit
                                            ↓
生产部署:  git push → 静态构建 → 部署静态文件（无 API）
```

## 🚀 启动管理后台

```bash
# 从项目根目录启动
pnpm run admin
```

管理后台将在以下地址运行：
- **Frontend**: `http://localhost:5173`
- **Backend**: `http://localhost:3000`

## 📊 功能概览

### 1. 项目管理 (Projects)
管理您的项目作品集，包括个人项目、开源贡献等。

**功能特性**：
- ✏️ 创建新项目
- 📝 编辑现有项目
- 🗑️ 删除项目
- 🔍 搜索和筛选（按类别、状态）
- 📊 统计面板（总数/已完成/进行中/计划中）

**支持的字段**：
- 项目标题和描述
- 分类（Web/移动应用/桌面应用/其他）
- 状态（已完成/进行中/计划中）
- 技术栈列表
- 开始/结束日期
- 演示链接和源码链接
- 标签和特色标记

### 2. 技能管理 (Skills)
展示您精通的技术技能和工具。

**功能特性**：
- ✏️ 创建新技能
- 📝 编辑现有技能
- 🗑️ 删除技能
- 🔍 按类别和级别筛选
- 📊 按技能水平统计（初级/中级/高级/专家）
- 🎨 按类别分组显示（前端/后端/数据库/工具/其他）

**支持的字段**：
- 技能名称和描述
- 类别
- 水平（初级/中级/高级/专家）
- 经验时长（年+月）
- 相关项目列表
- 认证证书列表
- 图标和颜色

### 3. 时间线管理 (Timeline)
记录您的职业发展历程和重要里程碑。

**功能特性**：
- ✏️ 创建新事件
- 📝 编辑现有事件
- 🗑️ 删除事件
- 🔍 按类型筛选（教育/工作/项目/成就）
- 📅 时间排序（最新优先/最早优先）
- 📊 按类型统计
- ⏱️ 可视化时间线展示

**支持的字段**：
- 事件标题和描述
- 类型（教育/工作/项目/成就）
- 开始/结束日期
- 地点
- 组织/机构
- 职位
- 相关技能列表
- 成就列表
- 外部链接

## 🎯 使用流程

### 创建新项目/技能/事件

1. 进入对应的管理页面（Projects/Skills/Timeline）
2. 点击右上角的 **"添加XX"** 按钮
3. 填写表单中的必填字段（标记为 * 的字段）
4. 根据需要填写可选字段
5. 点击 **"保存"** 按钮

### 编辑现有数据

1. 将鼠标悬停在要编辑的卡片上
2. 点击右上角出现的 **编辑图标** (✏️)
3. 在弹出的表单中修改数据
4. 点击 **"保存"** 保存更改

### 删除数据

1. 将鼠标悬停在要删除的卡片上
2. 点击右上角出现的 **删除图标** (🗑️)
3. 在确认对话框中点击 **"删除"** 确认操作

### 同步到 TypeScript 文件

完成编辑后，您需要**同步数据到 TypeScript 文件**，以便 Astro 网站使用最新数据：

1. 点击页面右上角的 **"同步到TS"** 按钮
2. 等待同步完成（会显示成功通知）
3. TypeScript 文件 (`src/data/*.ts`) 将自动更新

## 📁 数据存储

### 目录结构

```
src/data/
├── projects.ts          # TypeScript 数据文件（Astro 网站读取）
├── skills.ts
├── timeline.ts
└── json/                # JSON 数据源
    ├── projects.json    ← 管理后台编辑此文件
    ├── projects.backup.json  # 自动备份
    ├── skills.json      ← 管理后台编辑此文件
    ├── skills.backup.json
    ├── timeline.json    ← 管理后台编辑此文件
    └── timeline.backup.json
```

### 数据流程

```
1. 编辑数据 → 保存到 JSON 文件 (src/data/json/*.json)
2. 点击"同步" → 从 JSON 生成 TS 文件 (src/data/*.ts)
3. Astro 网站 → 读取 TS 文件渲染页面
```

### 安全备份

- ✅ 每次保存时自动创建 `.backup.json` 备份文件
- ✅ 可以随时从备份恢复数据
- ✅ JSON 和 TypeScript 文件都会被 Git 跟踪

## 🔄 Git 工作流建议

### 方式1：手动提交（推荐）

```bash
# 1. 在管理后台编辑数据并同步
# 2. 提交更改到 Git
git add src/data/json/*.json src/data/*.ts
git commit -m "更新项目/技能/时间线数据"
git push
```

### 方式2：自动同步

如果您希望使用现有的 Git 同步功能：
- 编辑数据后点击侧边栏的 **"Git Sync Now"** 按钮
- 系统会自动提交并推送更改

## 🛡️ 最佳实践

1. **定期同步**  
   编辑完成后立即点击"同步到TS"，确保网站显示最新数据

2. **检查备份**  
   重要操作前检查 `backup.json` 文件是否存在

3. **测试更改**  
   同步后刷新 Astro 开发服务器 (`pnpm dev`) 查看效果

4. **提交到 Git**  
   确认数据正确后提交到版本控制

5. **ID 命名规范**  
   使用小写字母和连字符，例如：`my-awesome-project`

## ❓ 常见问题

### Q: 如何恢复误删的数据？
A: 从 `src/data/json/*.backup.json` 文件恢复。将备份文件内容复制到主 JSON 文件即可。

### Q: 为什么编辑后网站没有更新？
A: 确保您点击了"同步到TS"按钮，并重启了 Astro 开发服务器（`pnpm dev`）。

### Q: 可以同时编辑多个数据吗？
A: 可以！但建议分别同步和测试，避免同时修改过多数据。

### Q: JSON 文件会被 TypeScript 覆盖吗？
A: 不会！数据流是单向的：JSON → TS。TypeScript 文件是从 JSON 生成的，不会反向覆盖。

### Q: 如何导入现有数据？
A: 直接编辑 `src/data/json/*.json` 文件，然后点击"同步到TS"即可。

## 🔧 技术细节

### API 端点

管理后台提供以下 REST API：

```
GET    /api/data/:type           # 获取所有数据
POST   /api/data/:type           # 创建新项
PUT    /api/data/:type/:id       # 更新项
DELETE /api/data/:type/:id       # 删除项
POST   /api/data/:type/sync      # 同步到 TS
```

其中 `:type` 可以是 `projects`、`skills` 或 `timeline`。

### 数据验证

- 所有必填字段在保存前会被验证
- ID 必须唯一且不可修改
- 日期格式必须为 YYYY-MM-DD

## 📚 相关文档

- [项目页面说明](./project_page.md)
- [技能页面说明](./skill_page.md)
- [时间线页面说明](./timeline_page.md)
- [部署指南](./DEPLOYMENT.md)

---

**提示**: 如果遇到任何问题，请查看控制台日志或提交 [Issue](https://github.com/matsuzaka-yuki/Mizuki/issues)。
